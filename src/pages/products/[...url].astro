---
import Layout from '../../layouts/Layout.astro';
import ProductImages from "../../components/ProductImages";
import SmallDesc from "../../components/SmallDesc";
import CurrentlyViewingBanner from "../../components/CurrentlyViewingBanner";
import Bundle from "../../components/Bundle";
import AddToCart from "../../components/AddToCart";
import Dropdowns from "../../components/Dropdowns";
import AddToCartPopup from '../../components/AddToCartPopup';
import ReviewsPage from "../../components/ReviewsPage";

export async function getStaticPaths() {
  // --- MOVED DATA INSIDE FUNCTION TO FIX SCOPE ERROR ---
  const mockProducts = [
    {
      _id: "1",
      name: "Portfolio Premium Product",
      url: "portfolio-premium-product",
      price: 49.95,
      oldPrice: 99.95,
      desc: `
        <div style="font-family: inherit; color: #2c2c2e; line-height: 1.8;">
          <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem; color: #1c1c1e;">
            Unmatched Durability Meets Modern Design
          </h3>
          <p style="margin-bottom: 1.5rem; font-size: 1rem; color: #555;">
            This isn't just a wallet; it's a statement. Engineered for the modern professional, the Portfolio Premium Product combines aerospace-grade materials with a sleek, minimalist profile. Whether you're closing deals in the boardroom or traveling internationally, this essential accessory ensures your cards are accessible, secure, and stylish.
          </p>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 2rem;">
            <div style="background: #fff; padding: 15px; border: 1px solid #e5e5e5; border-radius: 8px;">
              <strong style="display: block; color: #000; margin-bottom: 5px;">üõ°Ô∏è RFID Protection</strong>
              <span style="font-size: 0.9rem; color: #666;">Advanced blocking technology prevents digital theft and keeps your data safe.</span>
            </div>
            <div style="background: #fff; padding: 15px; border: 1px solid #e5e5e5; border-radius: 8px;">
              <strong style="display: block; color: #000; margin-bottom: 5px;">ü™∂ Ultra Lightweight</strong>
              <span style="font-size: 0.9rem; color: #666;">Weighing less than 2oz, you'll barely feel it in your pocket.</span>
            </div>
            <div style="background: #fff; padding: 15px; border: 1px solid #e5e5e5; border-radius: 8px;">
               <strong style="display: block; color: #000; margin-bottom: 5px;">‚ö° Quick Access</strong>
              <span style="font-size: 0.9rem; color: #666;">Patented slider mechanism ejects cards instantly with a single motion.</span>
            </div>
          </div>
          <h4 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: #1c1c1e;">Technical Specifications</h4>
          <div style="background: #f2f2f7; padding: 20px; border-radius: 8px; border-left: 4px solid #1c1c1e;">
            <ul style="list-style: none; padding: 0; margin: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <li style="font-size: 0.9rem;"><strong>Material:</strong> 3K Carbon Fiber</li>
              <li style="font-size: 0.9rem;"><strong>Capacity:</strong> 1-12 Cards</li>
              <li style="font-size: 0.9rem;"><strong>Dimensions:</strong> 86 x 54 x 6 mm</li>
              <li style="font-size: 0.9rem;"><strong>Warranty:</strong> Lifetime</li>
              <li style="font-size: 0.9rem;"><strong>Weight:</strong> 45 grams</li>
              <li style="font-size: 0.9rem;"><strong>Finish:</strong> Matte Coating</li>
            </ul>
          </div>
          <p style="margin-top: 1.5rem; font-style: italic; color: #888; font-size: 0.9rem;">
            *Note: This is a demonstration product for portfolio purposes.
          </p>
        </div>
      `,
      metaDesc: "A premium portfolio demonstration product.",
      smallDesc: [
        "Premium Quality Material",
        "Lifetime Warranty",
        "Free Express Shipping",
        "30-Day Money Back Guarantee"
      ],
      dropdowns: [
        {
          question: "What materials is this made of?",
          answer: "This product is crafted from high-grade, sustainable materials designed to last a lifetime."
        },
        {
          question: "How long is shipping?",
          answer: "Shipping takes 1-3 business days worldwide."
        }
      ],
      image: [
        "https://images.unsplash.com/photo-1627123424574-724758594e93?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
        "https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80"
      ],
      stock: 100,
      deliveryTime: 3,
      soldOut: false,
      free: false,
      models: ["Black Matte", "Silver", "Carbon Fiber"],
      reviewCount: 124,
      reviewAverage: 4.8,
      reviews: [
        {
          name: "John Doe",
          stars: 5,
          title: "Excellent Product",
          message: "I use this every day. The quality is outstanding for a portfolio demo!",
          date: new Date().toISOString()
        },
        {
          name: "Sarah Smith",
          stars: 4,
          title: "Great Value",
          message: "Shipping was fast and the item looks exactly like the pictures.",
          date: new Date().toISOString()
        }
      ]
    }
  ];

  // Filter out free gifts
  const filteredProducts = mockProducts.filter((product) => !product.free);

  const paths = filteredProducts.map((product) => ({
    params: { url: product.url },
    props: { 
      _id: product._id,
      name: product.name,
      price: product.price,
      desc: product.desc,
      metaDesc: product.metaDesc,
      oldPrice: product.oldPrice,
      image: product.image,
      smallDescs: product.smallDesc,
      dropdowns: product.dropdowns,
      reviews: product.reviews,
      models: product.models,
      product: product
    }
  }));

  return paths;
}

const { url } = Astro.params;
const { product, _id, name, price, oldPrice, image, desc, metaDesc, smallDescs, dropdowns, reviews, models } = Astro.props;
const title = name;
const description = metaDesc;
---

<Layout title={title} description={description}>
  <section class="singlep-main">
    <div class="singlep-main-container">
      <ProductImages images={image} client:load/>
      <section class="singlep-main-info">
        <div class="titles">
          <a href="/products">Back to all products</a>
          <h1>{name}</h1>
        </div>
        <SmallDesc smallDescs={smallDescs} client:load />
        <div class="product-payment">
          <p class="currentlyviewing">
            <img
              src="/svg/eye.svg"
              width="14"
              height="auto"
              decoding="async"
              alt="Eye icon"
            />
            <CurrentlyViewingBanner checkout={false} client:only/>
          </p>
          <div class="product-bundle">
            <Bundle price={price} oldPrice={oldPrice} models={models} client:load/>
            <p>Free shipping included</p>
            <AddToCart product={product} small={false} client:only />
          </div>
        </div>
        <div class="dropdowns">
          <Dropdowns dropdowns={dropdowns} client:load />
        </div>
      </section>
    </div>
  </section>
  <AddToCartPopup product={product} client:only />
  <section class="singlep-desc">
    <div set:html={desc}></div>
  </section>
  <ReviewsPage url={url} reviews={reviews} client:load />
</Layout>

<script>
	import { initVisit } from '../../stores/visit';
	
	initVisit();
</script>